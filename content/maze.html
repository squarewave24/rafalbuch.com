<html>
<style>
  #tableDiv table { border-spacing: 0; border-collapse: collapse;}
  #tableDiv td { border: 1px solid #dfdfdf; padding: 10px;}
  .alt { background-color: #EBFFF6;}
  /*#tableDiv table tr:nth-child(1n) {
    background-color: #EBFFF6;
  }*/
  #outputTextDiv { font-size: .6em; color: #666666; font-family: arial;}
</style>

<script>
	var _numbers = [
        
        [6,3,2,4,6,2,5],
        [3,5,2,4,4,4,1],
        [3,3,2,3,3,4,2],
        [3,4,1,2,2,5,3],
        [4,4,4,2,3,2,4],
        [2,5,4,2,3,2,5],
        [3,5,2,1,4,4,0]
        
			// [2,2,1],
			// [1,2,2],
			// [2,2,0]
      ];
    
    var _solutions = [];

	for (var i=0; i<_numbers.length; i++) {// rows
		for (var j=0; j<_numbers[i].length; j++) {// cols

			// document.write(_numbers[i][j], '&nbsp;');
			
			_numbers[i][j] = { x: j, y: i, v: _numbers[i][j], toString: function(){return '[' + this.x + ':' + this.y + '(' + this.v + ')]';}};
		}
    }


   function createMazeHtml(){
    var html = '<table>'
    for (var i=0; i<_numbers.length; i++) { // rows
      html += '<tr>'
      for (var j=0; j<_numbers[i].length; j++) { // cols
        
        var cellStyle = ((i+j) % 2) == 0 
          ? '' 
          : ' class="alt" ';
        html += '<td ' +  cellStyle + '>' + _numbers[i][j].v + '</td>'
      }
      html += '</tr>'
    }
    html += '</table>';
    
    var d = document.createElement('div');
    d.innerHTML = html;
    return d;
  }
  function writeOutput(text) {
    var d = document.createElement('div');
    d.innerHTML = text;
    
    document.getElementById('outputTextDiv').appendChild(d);
  }
  
  
  

  function move(node, direction, history) {
    history = history.slice(0);
    history.push(node);

    var nextNode = getNextNode(node, direction);
    if (!nextNode) 
      return; // no node exists at that address

    if (history.some(function(o){
      return o == nextNode;
    })){
    //   printTerminating(history); // DEBUG 
      console.log('terminating', node.toString(), direction, nextNode.toString(), JSON.stringify(history));
      return; // infinite loop detected, terminate!
    }
    
    // DEBUG
    // writeOutput(history.map(function(el) { return el.toString(); }) + ' ' + direction + ' ' + nextNode.toString());
    

    if (nextNode.v == 0){ // found solution
      history.push(nextNode);
      _solutions.push(history);
    }

    move(nextNode, 'up', history);
    move(nextNode, 'down', history);
    move(nextNode, 'right', history);
    move(nextNode, 'left', history);

    
  }

  function getNextNode(node, direction){
    var nextNode = null;
    if (node.v < 1) return nextNode;
    switch(direction){
     case 'up':
     if (node.y - node.v > -1)
      nextNode = _numbers[node.y - node.v][node.x];
    break;
    case 'down':
    if (node.y + node.v < _numbers.length)
      nextNode = _numbers[node.y + node.v][node.x];
    break;
    case 'left':
    if (node.x - node.v > -1)
      nextNode = _numbers[node.y][node.x - node.v];
    break;
    case 'right':
    if (node.x + node.v < _numbers.length)
     nextNode = _numbers[node.y][node.x + node.v];
   break;
   default:
   console.error('bad direction supplied: ', direction);
 }
   // debug 
   
    // var dbg = '...................' + 
    //   node.x + ':' + node.y + ' ' + 
    //   direction + '  ';
    //   if (nextNode)
    //     dbg += nextNode.x + ':' + nextNode.y;
      
    //   writeOutput(dbg);
 
 return nextNode;
}

function printWinner(history){
  writeOutput('solved in ' + (history.length - 1) + ' moves: ' + 
    history.map(
      function(el) { return el.toString(); }
      )
    );

}

function printTerminating(history){
  writeOutput('terminating: ' + history.length + ' moves: ' + 
    history.map(
      function(el) { return el.toString(); }
      )
    );

}


// tests 





</script>

<body>
  <div id="tableDiv">
  </div>
  <div id="outputTextDiv"></div>

  <script>
    document.getElementById('tableDiv').appendChild(createMazeHtml());
    var first = _numbers[0][0];
    
    move(first, 'down', []);
    move(first, 'right', []);
    
    writeOutput('solutions found: ' +  _solutions.length);
    _solutions.sort(function(a,b) {return a.length > b.length ? 1 : -1;});
    _solutions.forEach(function(s){
        
       writeOutput(
           s.length + ' moves: ' +
           s.map(function(el){ return ' ' + el.toString();})) 
    });  
    
  </script>


</body>

</html>



